use serde::{Deserialize, Serialize};

#[derive(
    Debug,
    Clone,
    Copy,
    PartialEq,
    Eq,
    Serialize,
    Deserialize,
)]
pub enum Language {
    English,
    Spanish,
    Russian,
}

impl Language {
    pub fn from_code(code: &str) -> Self {
        match code.split('-').next().unwrap_or("en") {
            "es" => Language::Spanish,
            "ru" => Language::Russian,
            _ => Language::English,
        }
    }
}

#[derive(Clone)]
pub struct Translations {
    pub note: &'static str,
    pub note_placeholder: &'static str,
    pub mode: &'static str,
    pub no_encryption: &'static str,
    pub password_encryption: &'static str,
    pub algorithm: &'static str,
    pub password: &'static str,
    pub password_placeholder: &'static str,
    pub generate_button: &'static str,
    pub share_title: &'static str,
    pub encrypted_note: &'static str,
    pub encrypted_note_desc: &'static str,
    pub decrypt_button: &'static str,
    pub your_note_title: &'static str,
    pub error_title: &'static str,
    pub loading: &'static str,
    pub create_new_note: &'static str,
    pub edit_note: &'static str,
    pub password_required: &'static str,
    pub no_note_in_url: &'static str,
    pub invalid_utf8: &'static str,
    pub cipher_error: &'static str,
    pub getrandom_error: &'static str,
    pub base64_error: &'static str,
    pub json_error: &'static str,
    pub qr_error: &'static str,
    pub encrypt_error: &'static str,
    pub decrypt_error: &'static str,
    pub url_error: &'static str,
    pub home: &'static str,
    pub copied: &'static str,
    pub copy_button: &'static str,
}

pub fn get_translations(lang: Language) -> Translations {
    match lang {
        Language::English => Translations {
            note: "Note",
            note_placeholder: "Enter your note here...",
            mode: "Mode",
            no_encryption: "No encryption (plaintext)",
            password_encryption: "Password encryption",
            algorithm: "Algo",
            password: "Password",
            password_placeholder: "Enter password",
            generate_button: "Share",
            share_title: "Share",
            encrypted_note: "Encrypted",
            encrypted_note_desc: "This note is encrypted. Enter the password to decrypt it.",
            decrypt_button: "Decrypt",
            your_note_title: "Note",
            error_title: "Error",
            loading: "Loading...",
            create_new_note: "Reset",
            edit_note: "Edit",
            password_required: "Password is required for encryption",
            no_note_in_url: "No note found in URL",
            invalid_utf8: "Decrypted data is not valid UTF-8",
            cipher_error: "Cipher initialization error",
            getrandom_error: "Random number generation error",
            base64_error: "Base64 decoding error",
            json_error: "JSON parsing error",
            qr_error: "QR code generation error",
            encrypt_error: "Encryption failed",
            decrypt_error: "Decryption failed",
            url_error: "Invalid URL format",
            home: "Home",
            copied: "Copied!",
            copy_button: "Copy",
        },
        Language::Spanish => Translations {
            note: "Nota",
            note_placeholder: "Escribe tu nota aquí...",
            mode: "Modo",
            no_encryption: "Sin cifrado (texto plano)",
            password_encryption: "Cifrado con contraseña",
            algorithm: "Algo",
            password: "Clave",
            password_placeholder: "Ingresa contraseña",
            generate_button: "Compartir",
            share_title: "Compartir",
            encrypted_note: "Cifrado",
            encrypted_note_desc: "Esta nota está cifrada. Ingresa la contraseña para descifrarla.",
            decrypt_button: "Descifrar",
            your_note_title: "Nota",
            error_title: "Error",
            loading: "Cargando...",
            create_new_note: "Reiniciar",
            edit_note: "Editar",
            password_required: "Se requiere contraseña para el cifrado",
            no_note_in_url: "No se encontró nota en la URL",
            invalid_utf8: "Los datos descifrados no son UTF-8 válidos",
            cipher_error: "Error de inicialización de cifrado",
            getrandom_error: "Error de generación de números aleatorios",
            base64_error: "Error de decodificación Base64",
            json_error: "Error de análisis JSON",
            qr_error: "Error de generación de código QR",
            encrypt_error: "Falló el cifrado",
            decrypt_error: "Falló el descifrado",
            url_error: "Formato de URL inválido",
            home: "Inicio",
            copied: "¡Copiado!",
            copy_button: "Copiar",
        },
        Language::Russian => Translations {
            note: "Заметка",
            note_placeholder: "Введите вашу заметку здесь...",
            mode: "Режим",
            no_encryption: "Без шифрования (открытый текст)",
            password_encryption: "Шифрование паролем",
            algorithm: "Алго",
            password: "Пароль",
            password_placeholder: "Введите пароль",
            generate_button: "Поделиться",
            share_title: "Поделиться",
            encrypted_note: "Шифр",
            encrypted_note_desc: "Эта заметка зашифрована. Введите пароль для расшифровки.",
            decrypt_button: "Расшифровать",
            your_note_title: "Заметка",
            error_title: "Ошибка",
            loading: "Загрузка...",
            create_new_note: "Сброс",
            edit_note: "Правка",
            password_required: "Для шифрования требуется пароль",
            no_note_in_url: "Заметка не найдена в URL",
            invalid_utf8: "Расшифрованные данные не являются допустимым UTF-8",
            cipher_error: "Ошибка инициализации шифра",
            getrandom_error: "Ошибка генерации случайных чисел",
            base64_error: "Ошибка декодирования Base64",
            json_error: "Ошибка разбора JSON",
            qr_error: "Ошибка генерации QR-кода",
            encrypt_error: "Ошибка шифрования",
            decrypt_error: "Ошибка расшифровки",
            url_error: "Неверный формат URL",
            home: "Главная",
            copied: "Скопировано!",
            copy_button: "Копировать",
        },
    }
}

pub fn detect_browser_language() -> Language {
    web_sys::window()
        .and_then(|w| w.navigator().language())
        .map(|lang| Language::from_code(&lang))
        .unwrap_or(Language::English)
}
